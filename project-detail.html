<!doctype html>
<html lang="en" class="tw-dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Project Details - Roberto Di Maria</title>
        <meta name="description" content="Detailed project information" />
        <link rel="shortcut icon" href="./new/assets/logo/logo.png" type="image/x-icon" />

        <link rel="stylesheet" href="new/css/tailwind-build.css">
        <link rel="stylesheet" href="new/css/index.css" />

        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css"
            integrity="sha512-dPXYcDub/aeb08c63jRq/k6GaKccl256JQy/AnOq7CAnEZ9FzSL9wSbcZkMp4R26vBsMLFYH4kQ67/bbV8XaCQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        
        <!-- MathJax for LaTeX rendering -->
        <script>
            MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']]
                }
            };
        </script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <style>
            body {
                padding-top: 80px;
            }
            
            .project-container {
                display: flex;
                max-width: 1400px;
                margin: 0 auto;
                gap: 2rem;
                padding: 2rem;
            }
            
            .table-of-contents {
                position: sticky;
                top: 100px;
                width: 250px;
                height: fit-content;
                padding: 1.5rem;
                background-color: #171717;
                border-radius: 12px;
                border: 1px solid #2a2a2a;
                flex-shrink: 0;
            }
            
            .table-of-contents h3 {
                font-size: 1.25rem;
                font-weight: 600;
                color: #ffffff;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
                border-bottom: 2px solid #6366f1;
            }
            
            .table-of-contents ul {
                list-style: none;
                padding: 0;
                margin: 0;
            }
            
            .table-of-contents li {
                margin-bottom: 0.75rem;
            }
            
            .table-of-contents a {
                color: #b0b0b0;
                text-decoration: none;
                transition: color 0.3s, padding-left 0.3s;
                display: block;
                padding: 0.5rem 0;
                font-size: 0.95rem;
            }
            
            .table-of-contents a:hover {
                color: #6366f1;
                padding-left: 0.5rem;
            }
            
            .table-of-contents a.active {
                color: #6366f1;
                font-weight: 600;
                padding-left: 0.5rem;
                border-left: 3px solid #6366f1;
            }
            
            .project-content {
                flex: 1;
                max-width: 1000px;
            }
            
            .project-section {
                scroll-margin-top: 100px;
            }
            
            .project-content h1 {
                font-size: 2.5rem;
                font-weight: 600;
                margin-bottom: 2rem;
            }
            
            .project-content h2 {
                font-size: 2rem;
                font-weight: 600;
                margin-top: 3rem;
                margin-bottom: 1.5rem;
                padding-bottom: 0.5rem;
            }
            
            .project-content h3 {
                font-size: 1.5rem;
                font-weight: 600;
                margin-top: 2rem;
                margin-bottom: 1rem;
            }
            
            .project-content h4 {
                font-size: 1.25rem;
                font-weight: 600;
                margin-top: 1.5rem;
                margin-bottom: 0.75rem;
            }
            
            .project-content p {
                line-height: 1.8;
                margin-bottom: 1.5rem;
            }
            
            .project-content ul,
            .project-content ol {
                line-height: 1.8;
                margin-bottom: 1.5rem;
                padding-left: 2rem;
            }
            
            .project-content li {
                margin-bottom: 0.75rem;
            }
            
            .project-content figure {
                margin: 2.5rem auto;
                text-align: center;
            }
            
            .project-content figure img {
                max-width: 100%;
                height: auto;
                border-radius: 8px;
            }
            
            .project-content figcaption {
                margin-top: 1rem;
                font-size: 0.9rem;
                font-style: italic;
            }
            
            .project-content strong {
                font-weight: 600;
            }
            
            /* Light mode styles */
            .project-content h1,
            .project-content h2,
            .project-content h3,
            .project-content h4 {
                color: #1a1a1a;
            }
            
            .project-content h2 {
                border-bottom: 2px solid #e0e0e0;
            }
            
            .project-content p,
            .project-content ul,
            .project-content ol,
            .project-content li {
                color: #4a4a4a;
            }
            
            .project-content strong {
                color: #1a1a1a;
            }
            
            .project-content figcaption {
                color: #666;
            }
            
            .project-content figure img {
                border: 1px solid #e0e0e0;
            }
            
            /* Dark mode overrides */
            .tw-dark .project-content h1,
            .tw-dark .project-content h2,
            .tw-dark .project-content h3,
            .tw-dark .project-content h4 {
                color: #ffffff;
            }
            
            .tw-dark .project-content h2 {
                border-bottom: 2px solid #3a3a3a;
            }
            
            .tw-dark .project-content p,
            .tw-dark .project-content ul,
            .tw-dark .project-content ol,
            .tw-dark .project-content li {
                color: #ffffff;
            }
            
            .tw-dark .project-content strong {
                color: #ffffff;
            }
            
            .tw-dark .project-content figcaption {
                color: #cccccc;
            }
            
            .tw-dark .project-content figure img {
                border: 1px solid #3a3a3a;
            }
            
            .back-button {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.75rem 1.5rem;
                background-color: #6366f1;
                color: white;
                border-radius: 0.5rem;
                text-decoration: none;
                transition: all 0.3s;
                margin-top: 4rem;
                margin-bottom: 2rem;
            }
            
            .back-button:hover {
                background-color: #4f46e5;
                transform: translateX(-5px);
            }
            
            /* Ensure flex containers with images work responsively */
            .project-content div[style*="display: flex"] {
                display: flex !important;
                flex-direction: column !important;
                align-items: center;
                gap: 20px;
                margin: 20px 0;
            }
            
            .project-content div[style*="display: flex"] img {
                max-width: 800px;
                width: 100%;
                height: auto;
            }
            
            /* Center all images */
            .project-content img {
                display: block;
                margin: 0 auto;
                max-width: 100%;
                height: auto;
            }
            
            /* Center all images in flex containers */
            .project-content div[style*="display: flex"] {
                align-items: center;
            }
            
            @media (max-width: 768px) {
                body {
                    padding-top: 60px;
                }
                
                .project-container {
                    flex-direction: column;
                    padding: 1rem;
                }
                
                .table-of-contents {
                    position: static;
                    width: 100%;
                }
                
                .project-content {
                    padding: 1rem;
                }
                
                .project-section {
                    scroll-margin-top: 80px;
                }
                
                .project-content h1 {
                    font-size: 2rem;
                }
                
                .project-content h2 {
                    font-size: 1.5rem;
                }
                
                /* Stack images on mobile devices */
                .project-content div[style*="display: flex"] {
                    flex-direction: column !important;
                }
                
                .project-content div[style*="display: flex"] img {
                    max-width: 100% !important;
                    width: 100% !important;
                }
            }
        </style>
    </head>
    <body class="tw-flex tw-min-h-[100vh] tw-flex-col tw-bg-[#fcfcfc] tw-text-black dark:tw-bg-black dark:tw-text-white">
        <header
            class="lg:tw-px-4 tw-max-w-[100vw] tw-max-w-lg:tw-mr-auto max-lg:tw-top-0 tw-fixed tw-top-4 lg:tw-left-1/2 lg:tw--translate-x-1/2 tw-z-20 tw-flex tw-h-[60px] tw-w-full 
                    tw-text-gray-700 tw-bg-white dark:tw-text-gray-200 dark:tw-bg-[#17181b] tw-px-[3%] tw-rounded-md lg:tw-max-w-5xl tw-shadow-md dark:tw-shadow-gray-700
                    lg:tw-justify-around lg:!tw-backdrop-blur-lg lg:tw-opacity-[0.99]"
        >
            <a class="tw-flex tw-p-[4px] tw-gap-2 tw-place-items-center" href="index.html">
                <span class="tw-uppercase tw-text-base tw-font-medium" style="width: 160px;">Roberto Di Maria</span>
            </a>
            <div
                class="collapsible-header animated-collapse max-lg:tw-shadow-md"
                id="collapsed-header-items"
            >
                <nav
                    class="tw-relative tw-flex tw-h-full max-lg:tw-h-max tw-w-max tw-gap-5 tw-text-base max-lg:tw-mt-[30px] max-lg:tw-flex-col 
                                max-lg:tw-gap-5 lg:tw-mx-auto tw-place-items-center"
                >
                    <a class="header-links" href="about.html"> About </a>
                    <a class="header-links" href="index.html#projects"> Projects </a>
                    <a class="header-links" href="index.html#contact"> Contact </a>
                </nav>
                <div
                    class="lg:tw-mx-4 tw-flex tw-place-items-center tw-gap-[20px] tw-text-base max-md:tw-w-full 
                            max-md:tw-flex-col max-md:tw-place-content-center"
                >
                    <button type="button" onclick="toggleMode()" class="header-links tw-text-gray-600 dark:tw-text-gray-300" title="toggle-theme" 
                            id="theme-toggle"> 
                        <i class="bi bi-sun" id="toggle-mode-icon"></i>
                    </button>
                </div>
            </div>
            <button
                class="bi bi-list tw-absolute tw-right-3 tw-top-3 tw-z-50 tw-text-3xl tw-text-gray-500 lg:tw-hidden"
                onclick="toggleHeader()"
                aria-label="menu"
                id="collapse-btn"
            ></button>
        </header>

        <main class="tw-mb-[50px]">
            <div class="project-container">
                <!-- Table of Contents -->
                <nav class="table-of-contents" id="toc-container">
                    <h3>Contents</h3>
                    <ul id="toc-list">
                        <!-- TOC will be dynamically populated -->
                    </ul>
                </nav>
                
                <div class="project-content">
                    <a href="index.html#projects" class="back-button">
                        <i class="bi bi-arrow-left"></i>
                        <span>Back to Projects</span>
                    </a>
                    
                    <div id="project-detail">
                        <p>Loading project details...</p>
                    </div>
                </div>
            </div>
        </main>

        <footer
            class="tw-mt-auto tw-flex tw-flex-col tw-w-full tw-gap-4 tw-text-sm tw-pt-[5%] tw-pb-10 tw-px-[10%] 
                    tw-text-black dark:tw-text-white max-md:tw-flex-col"
        >
            <div class="tw-flex max-md:tw-flex-col max-md:tw-gap-6 tw-gap-3 tw-w-full tw-place-content-around">
                <div class="tw-flex tw-h-full tw-w-[250px] tw-flex-col tw-place-items-center tw-gap-6 max-md:tw-w-full">   
                    <a href="index.html" class="tw-w-full tw-place-items-center tw-flex tw-flex-col tw-gap-6">
                        <div class="tw-max-w-[360px] tw-text-center tw-text-2xl tw-h-fit tw-font-semibold">
                            Roberto Di Maria
                        </div>
                    </a>
                    <div class="tw-flex tw-gap-4 tw-text-lg">
                        <a href="https://github.com/robertodimaria" aria-label="Github" target="_blank" rel="noopener noreferrer">
                            <i class="bi bi-github"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/roberto-di-maria" aria-label="Linkedin" target="_blank" rel="noopener noreferrer">
                            <i class="bi bi-linkedin"></i>
                        </a>
                        <a href="mailto:dimaria.roberto@studium.unict.it" aria-label="Email">
                            <i class="bi bi-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="tw-mt-8">
            <div class="tw-mt-2 tw-flex tw-gap-2 tw-flex-col tw-text-gray-700 dark:tw-text-gray-300 tw-place-items-center 
                    tw-text-[12px] tw-w-full tw-text-center tw-place-content-around">
                <span>Copyright &#169; 2024-2025 Roberto Di Maria</span>
                <span>Mechanical Engineering Portfolio</span>
            </div>
        </footer>

        <script src="./projectsData.js"></script>
        <script src="./utils.js"></script>
        <script>
            // Load project details
            const urlParams = new URLSearchParams(window.location.search);
            // Sanitize the projectId parameter - only allow alphanumeric characters and hyphens
            const rawProjectId = urlParams.get('id');
            const projectId = rawProjectId ? rawProjectId.replace(/[^a-zA-Z0-9-]/g, '') : null;
            
            const project = projectsData.find(p => p.id === projectId);
            const detailDiv = document.getElementById('project-detail');
            const tocList = document.getElementById('toc-list');
            const tocContainer = document.getElementById('toc-container');
            
            if (project) {
                const titleElement = document.createElement('h1');
                titleElement.textContent = project.title;
                
                const contentDiv = document.createElement('div');
                // Note: projectsData.js is a trusted, controlled data source maintained by the site owner.
                // The fullContent contains intentional HTML formatting (figures, lists, etc.) for rich
                // project descriptions. This is safe as the data is not user-generated.
                contentDiv.innerHTML = project.fullContent;
                
                document.title = project.title + ' - Roberto Di Maria';
                
                detailDiv.innerHTML = '';
                detailDiv.appendChild(titleElement);
                detailDiv.appendChild(contentDiv);
                
                // Generate table of contents from h2 elements
                const h2Elements = contentDiv.querySelectorAll('h2');
                
                if (h2Elements.length > 0) {
                    h2Elements.forEach((h2, index) => {
                        // Create unique ID for each section
                        const sectionId = 'section-' + index;
                        h2.id = sectionId;
                        h2.classList.add('project-section');
                        
                        // Create TOC list item
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = '#' + sectionId;
                        a.textContent = h2.textContent;
                        
                        li.appendChild(a);
                        tocList.appendChild(li);
                    });
                    
                    // Scroll spy for table of contents
                    const sections = contentDiv.querySelectorAll('.project-section');
                    const tocLinks = tocList.querySelectorAll('a');
                    
                    function updateActiveLink() {
                        let current = '';
                        
                        sections.forEach(section => {
                            const sectionTop = section.offsetTop;
                            const sectionHeight = section.clientHeight;
                            if (window.scrollY >= sectionTop - 150) {
                                current = section.getAttribute('id');
                            }
                        });
                        
                        tocLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === '#' + current) {
                                link.classList.add('active');
                            }
                        });
                    }
                    
                    // Update active link on scroll
                    window.addEventListener('scroll', updateActiveLink);
                    
                    // Update active link on page load
                    updateActiveLink();
                    
                    // Smooth scroll for TOC links
                    tocLinks.forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const targetId = link.getAttribute('href');
                            const targetSection = document.querySelector(targetId);
                            if (targetSection) {
                                const offsetTop = targetSection.offsetTop - 80;
                                window.scrollTo({
                                    top: offsetTop,
                                    behavior: 'smooth'
                                });
                            }
                        });
                    });
                } else {
                    // Hide TOC if no sections found
                    tocContainer.style.display = 'none';
                }
                
                // Trigger MathJax to process the newly added content
                function typesetMath() {
                    if (window.MathJax && MathJax.typesetPromise) {
                        MathJax.typesetPromise([detailDiv]).catch((err) => console.log('MathJax typeset error:', err));
                    }
                }
                
                // Try to typeset immediately, or wait for MathJax to load
                if (window.MathJax) {
                    typesetMath();
                } else {
                    // MathJax not loaded yet, wait for it
                    document.getElementById('MathJax-script').addEventListener('load', typesetMath, { once: true });
                }
            } else {
                detailDiv.innerHTML = `
                    <h1>Project Not Found</h1>
                    <p>Sorry, the requested project could not be found.</p>
                    <a href="index.html#projects" class="back-button">
                        <i class="bi bi-arrow-left"></i>
                        <span>Return to Projects</span>
                    </a>
                `;
                // Hide TOC when project not found
                tocContainer.style.display = 'none';
            }
        </script>
    </body>
</html>
